import 'package:flutter/widgets.dart';

import 'app_localizations.dart';
import 'package:intl/intl.dart' as intl;

/// Extensions for localization capabilities that are not generated by gen-l10n.
/// Keep this file stable across regeneration and avoid modifying generated code.
extension AppLocalizationsX on AppLocalizations {
  /// Capability: whether granular password error strings are available.
  /// Intentional design: kept `true` and enforced via CI test that
  /// all ARB locales define the granular password error keys.
  bool get hasGranularPasswordErrors => true;
}

/// Temporary additive API for newly added auth error strings.
/// Once gen-l10n runs, generated instance members will take precedence and
/// these extension members will be effectively shadowed.
extension AppLocalizationsAuthAdditions on AppLocalizations {
  String get authErrEmailEmpty {
    switch (localeName) {
      case 'de':
        return 'Bitte gib deine E-Mail ein.';
      default:
        return 'Please enter your email.';
    }
  }

  String get authErrPasswordEmpty {
    switch (localeName) {
      case 'de':
        return 'Bitte gib dein Passwort ein.';
      default:
        return 'Please enter your password.';
    }
  }

  String authErrWaitBeforeRetry(int seconds) {
    switch (localeName) {
      case 'de':
        return intl.Intl.pluralLogic(
          seconds,
          locale: localeName,
          one: 'Bitte warte $seconds Sekunde, bevor du es erneut versuchst.',
          other: 'Bitte warte $seconds Sekunden, bevor du es erneut versuchst.',
        );
      default:
        return intl.Intl.pluralLogic(
          seconds,
          locale: localeName,
          one: 'Please wait $seconds second before retrying.',
          other: 'Please wait $seconds seconds before retrying.',
        );
    }
  }
}

/// Safe accessor for AppLocalizations via BuildContext.
/// Provides clear debug assertion when localizations are not configured.
extension BuildContextL10n on BuildContext {
  /// Returns AppLocalizations with descriptive error in debug mode if not found.
  ///
  /// Usage: `final l10n = context.l10n;`
  AppLocalizations get l10n {
    final localizations = AppLocalizations.of(this);
    assert(
      localizations != null,
      'No AppLocalizations found in context. '
      'Ensure MaterialApp includes localizationsDelegates and supportedLocales.',
    );
    return localizations!;
  }
}
