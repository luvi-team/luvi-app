# S0.D1 – Consent E2E (anti-spoof) + Legal Fallback + Events/Flags (Final Report)
Goal: Server setzt user_id (JWT) + Serverzeit; Legal-Web/Fallback; Event consent_accepted; keine Schema-Änderung.
Plan: Edge-Fn härten → Event nach Erfolg → Legal-Viewer & Assets → Flags/Facade zentral → Smoke 401/201 → analyze/test.
Risks: Paketname/Imports, fehlende JWT bei Pre-Auth, Link-Misconfig.
Tests: Unit(Service Erfolg/Fehler), Widget(CTA→accept→track), Smoke curl 401/201.
Self-Check: ✅ Edge ok; ✅ Facade ok; ✅ Legal ok; ✅ Event wired.

## DSGVO Compliance
- **PII handled:** user_id (from JWT), consent version, scopes, server timestamp
- **RLS Policy:** Edge function enforces JWT auth; consent records tied to authenticated user only
- **Retention:** Consent records retained indefinitely per legal requirements (Art. 7(1) DSGVO)
- **Checklist:** See docs/compliance/dsgvo_checklist.md for full compliance review
- **Tests:** test/features/consent/consent_service_test.dart, test/features/consent/consent02_screen_enable_test.dart
