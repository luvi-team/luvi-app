# Privacy Review – 20250907205727_drop_duplicate_cycle_data_trigger.sql
**Datum:** 2025-09-07  
**Änderungstyp:** DB-Migration (Supabase, EU/Frankfurt)

## Zweck & Scope
Entfernt redundanten Trigger `trg_cycle_owner` (IaC-Hygiene). Keine neuen personenbezogenen Datenfelder; reine Bereinigung. `trg_cycle_owner` setzte `user_id := auth.uid()` bei INSERT/UPDATE; `set_cycle_data_user_id` übernimmt diese Ownership-Zuweisung bereits, daher geht keine Schutzwirkung verloren.

## Datenkategorien
Art. 9 (Gesundheitsbezug) möglich in `cycle_data` (bereits bestehend). **Diese Migration fügt keine neuen PII-Spalten hinzu.**

## Rechtsgrundlage
Einwilligung (Consent) – bereits implementiertes Consent-Gate bleibt unverändert.

## Technische Schutzmaßnahmen
- RLS: owner-based (`user_id = auth.uid()`), alle CRUD-Policies vorhanden.
- Trigger: `set_cycle_data_user_id` bleibt bestehen, nur Duplikat entfernt.
- Unique-Index pro User (`ux_cycle_data_user`) verhindert Mehrfacheinträge.

## Risiko & Mitigation
- Risiko Fehlkonfiguration Client → **Mitigation:** Verbleibender Trigger + RLS.
- Risiko Datenzugriff fremder User → **Mitigation:** RLS-Beweis getestet (A/B-JWT).

## Migrations-Auswirkung
Keine Datenmigration; nur Trigger-Drop. Kein Downtime-Risiko.

## Rollback
- Voraussetzung: Funktion `public.set_cycle_data_user_id()` muss existieren.
- Trigger wiederherstellen: `CREATE TRIGGER trg_cycle_owner BEFORE INSERT OR UPDATE ON public.cycle_data FOR EACH ROW EXECUTE FUNCTION public.set_cycle_data_user_id();`

## Entscheidung
✅ Freigabe – keine zusätzlichen Datenschutzrisiken, Code-Hygiene verbessert.
